<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Debug - Step by Step</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .debug { background: #f8f9fa; color: #6c757d; }
        #map { height: 400px; width: 100%; border: 2px solid #ddd; background: #f8f9fa; }
        .step { margin: 10px 0; padding: 10px; border-left: 4px solid #007bff; }
    </style>
</head>
<body>
    <h1>Map Debug - Step by Step</h1>

    <div id="results"></div>

    <div class="mt-4">
        <button class="btn btn-primary" onclick="runStepByStepTest()">Run Step-by-Step Test</button>
        <button class="btn btn-secondary" onclick="location.reload()">Reload</button>
    </div>

    <div class="mt-4">
        <h4>Map Test Area:</h4>
        <div id="map">
            <div class="text-center p-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-muted">Waiting for test...</p>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0;
        const steps = [
            'Check if page loads',
            'Check if Mapbox CSS loads',
            'Check if Mapbox JS loads',
            'Check if mapboxgl object exists',
            'Check if access token is valid',
            'Check if map container exists',
            'Try to create map instance',
            'Check if map loads successfully'
        ];

        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `<strong>Step ${currentStep + 1}:</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
            currentStep++;
        }

        function runStepByStepTest() {
            currentStep = 0;
            document.getElementById('results').innerHTML = '';
            addResult('Starting step-by-step test...', 'info');

            // Step 1: Check if page loads
            addResult('Page loaded successfully', 'success');

            // Step 2: Load Mapbox CSS
            const cssLink = document.createElement('link');
            cssLink.rel = 'stylesheet';
            cssLink.href = 'https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css';
            cssLink.onload = () => {
                addResult('Mapbox CSS loaded successfully', 'success');

                // Step 3: Load Mapbox JS
                const script = document.createElement('script');
                script.src = 'https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js';
                script.onload = () => {
                    addResult('Mapbox JS loaded successfully', 'success');

                    // Step 4: Check if mapboxgl object exists
                    if (typeof mapboxgl !== 'undefined') {
                        addResult('mapboxgl object exists', 'success');

                        // Step 5: Check access token
                        const token = 'pk.eyJ1IjoiZ3lhbnNpbmdoMTgiLCJhIjoiY21ic3MxZ3BiMGE2cDJtc2lpN3pnNXN6NCJ9.4UhCbEv0elEp6VG8OrtEgg';
                        if (token && token.length > 50) {
                            addResult(`Access token is valid (length: ${token.length})`, 'success');

                            // Step 6: Check map container
                            const mapContainer = document.getElementById('map');
                            if (mapContainer) {
                                addResult('Map container exists', 'success');

                                // Step 7: Try to create map instance
                                try {
                                    mapboxgl.accessToken = token;
                                    addResult('Access token set successfully', 'success');

                                    const map = new mapboxgl.Map({
                                        container: 'map',
                                        style: 'mapbox://styles/mapbox/streets-v11',
                                        center: [78.9629, 20.5937],
                                        zoom: 4
                                    });

                                    addResult('Map instance created successfully', 'success');

                                    // Step 8: Check if map loads
                                    map.on('load', () => {
                                        addResult('Map loaded successfully!', 'success');
                                        // Hide loading spinner
                                        const loadingDiv = document.querySelector('#map > div');
                                        if (loadingDiv) {
                                            loadingDiv.style.display = 'none';
                                        }
                                    });

                                    map.on('error', (e) => {
                                        addResult(`Map error: ${e.error}`, 'error');
                                    });

                                } catch (error) {
                                    addResult(`Error creating map: ${error.message}`, 'error');
                                }
                            } else {
                                addResult('Map container not found', 'error');
                            }
                        } else {
                            addResult('Access token is invalid', 'error');
                        }
                    } else {
                        addResult('mapboxgl object not found', 'error');
                    }
                };
                script.onerror = () => {
                    addResult('Failed to load Mapbox JS', 'error');
                };
                document.head.appendChild(script);
            };
            cssLink.onerror = () => {
                addResult('Failed to load Mapbox CSS', 'error');
            };
            document.head.appendChild(cssLink);
        }

        // Auto-test on page load
        window.addEventListener('load', () => {
            addResult('Page loaded, ready for testing...', 'info');
        });
    </script>
</body>
</html>
